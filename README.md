# Forecast in a Box

<p align="center">
  <a href="https://github.com/ecmwf/codex/raw/refs/heads/main/Project%20Maturity">
    <img src="https://github.com/ecmwf/codex/raw/refs/heads/main/Project%20Maturity/sandbox_badge.svg" alt="Static Badge">
  </a>

<a href="https://codecov.io/gh/ecmwf/forecast-in-a-box">
    <img src="https://codecov.io/gh/ecmwf/forecast-in-a-box/branch/develop/graph/badge.svg" alt="Code Coverage">
  </a>

<a href="https://opensource.org/licenses/apache-2-0">
    <img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="License: Apache 2.0">
  </a>

<a href="https://github.com/ecmwf/forecast-in-a-box/releases">
    <img src="https://img.shields.io/github/v/release/ecmwf/forecast-in-a-box?color=blue&label=Release&style=flat-square" alt="Latest Release">
  </a>
</p>

> \[!IMPORTANT\]
> This software is **Sandbox** and subject to ECMWF's guidelines on [Software Maturity](https://github.com/ecmwf/codex/raw/refs/heads/main/Project%20Maturity).

Forecast-In-A-Box is a prototype system to deliver ECMWF products on demand as generated by Anemoi models. It integrates pproc, anemoi, earthkit and other components of the ECMWF stack.

## Installation

Python 3.11 is required due to the built versions of some of the downstream packages.

### Setup Backend

```bash
uv venv --seed ./ --python 3.11
uv pip install ./backend[all]
```

### Setup frontend

```bash
cd frontend
npm install yarn
```

### Running

Running the server

```bash
cd frontend
yarn dev

cd backend
uvicorn forecastbox.entrypoint:app --reload --log-level info
python -m cascade.gateway tcp://localhost:8067
```

### Docker

Set the ecmwf-api-client keys from [ECMWF API Key Management](https://api.ecmwf.int/v1/key/) as env vars.

Example:

`echo 'ECMWF_API_KEY="12345"
ECMWF_API_EMAIL="user@example.com"
' > .env`

Then:

```bash
docker-compose up --build
```

Visit http://localhost:8080

### Notes

Since the wheels for the underlying C++ is new, it has to be manually installed
when running outside of ATOS.

```bash
uv pip install --prerelease allow fdb5lib mirlib --upgrade
```

If backend holds port open after stopped, kill it: `fuser -k 12346/tcp`
